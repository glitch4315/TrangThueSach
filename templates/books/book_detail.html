<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ book.title }} - BookFire</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f0f0f; color: #e0e0e0; }

        .header { background: #1a1a1a; border-bottom: 1px solid #2a2a2a; padding: 1rem 0; position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; display: flex; align-items: center; gap: 2rem; justify-content: space-between; }
        .logo { font-size: 1.8rem; font-weight: bold; color: #ff6b6b; text-decoration: none; }
        .logo span { color: #fff; }
        .cart-btn { background: #ff6b6b; padding: 0.6rem 1.2rem; border-radius: 6px; color: white !important; text-decoration: none; position: relative; }
        .cart-count { position: absolute; top: -8px; right: -8px; background: #fff; color: #ff6b6b; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; }

        .container { max-width: 1400px; margin: 0 auto; padding: 3rem 2rem; }
        .breadcrumb { color: #888; margin-bottom: 2rem; }
        .breadcrumb a { color: #ff6b6b; text-decoration: none; }

        .book-detail { display: grid; grid-template-columns: 350px 1fr; gap: 3rem; }
        .book-image { width: 100%; height: 500px; background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); border-radius: 12px; overflow: hidden; }
        .book-image img { width: 100%; height: 100%; object-fit: cover; }

        .book-content h1 { font-size: 2.5rem; color: white; margin-bottom: 1rem; }
        .book-meta { display: flex; gap: 2rem; margin-bottom: 2rem; }
        .meta-item { color: #888; }
        .meta-item strong { color: white; }
        .rating { color: #ffd700; font-size: 1.2rem; }

        .book-price { font-size: 2.5rem; color: #ff6b6b; font-weight: bold; margin-bottom: 2rem; }
        .book-price small { font-size: 1rem; color: #888; }

        .availability { background: #1a4d1a; color: #4ade80; padding: 0.5rem 1rem; border-radius: 6px; display: inline-block; margin-bottom: 2rem; }
        .availability.out { background: #4d1a1a; color: #ff6b6b; }

        .rental-form { background: #1a1a1a; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; color: white; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input { width: 100%; padding: 0.8rem; background: #2a2a2a; border: 1px solid #3a3a3a; border-radius: 8px; color: white; font-size: 1rem; }

        .btn { padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; font-weight: 600; }
        .btn-primary { background: #ff6b6b; color: white; width: 100%; }
        .btn-primary:hover { background: #ff5252; transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }

        .book-description { margin-top: 2rem; }
        .book-description h2 { color: white; margin-bottom: 1rem; }
        .book-description p { line-height: 1.8; color: #b0b0b0; }

        .similar-books { margin-top: 4rem; }
        .section-title { font-size: 1.8rem; color: white; margin-bottom: 1.5rem; }
        .section-title::before { content: ''; display: inline-block; width: 4px; height: 24px; background: #ff6b6b; margin-right: 0.8rem; vertical-align: middle; }

        .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        .book-card { background: #1a1a1a; border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.3s; }
        .book-card:hover { transform: translateY(-5px); box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3); }
        .book-cover { width: 100%; height: 260px; background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%); position: relative; }
        .book-cover img { width: 100%; height: 100%; object-fit: cover; }
        .book-info { padding: 1rem; }
        .book-title { color: white; font-size: 0.95rem; font-weight: 600; margin-bottom: 0.5rem; }
        .book-author { color: #888; font-size: 0.85rem; }

        @media (max-width: 768px) {
            .book-detail { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <a href="/" class="logo">Book<span>Fire</span></a>
            <a href="{% url 'cart' %}" class="cart-btn">
                üõí Gi·ªè H√†ng
                {% if cart_count > 0 %}
                <span class="cart-count">{{ cart_count }}</span>
                {% endif %}
            </a>
        </nav>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a href="/">Trang ch·ªß</a> / <a href="/?category={{ book.category }}">{{ book.category }}</a> / {{ book.title }}
        </div>

        <div class="book-detail">
            <div class="book-image">
                {% if book.cover_image %}
                <img src="{{ book.cover_image }}" alt="{{ book.title }}">
                {% else %}
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 5rem;">üìñ</div>
                {% endif %}
            </div>

            <div class="book-content">
                <h1>{{ book.title }}</h1>
                <div class="book-meta">
                    <div class="meta-item"><strong>T√°c gi·∫£:</strong> {{ book.author }}</div>
                    <div class="meta-item"><strong>Th·ªÉ lo·∫°i:</strong> {{ book.category }}</div>
                    <div class="meta-item"><strong>NƒÉm XB:</strong> {{ book.publication_year }}</div>
                    <div class="rating">‚≠ê {{ book.rating }}/5.0</div>
                </div>

                <div class="book-price">{{ book.rental_price_per_day }}k <small>/ng√†y</small></div>

                {% if book.available_copies > 0 %}
                <div class="availability">‚úÖ C√≤n {{ book.available_copies }} cu·ªën</div>
                {% else %}
                <div class="availability out">‚ùå H·∫øt h√†ng</div>
                {% endif %}

                {% if book.available_copies > 0 %}
                <form action="{% url 'add_to_cart' book.id %}" method="post" class="rental-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label>S·ªë ng√†y thu√™</label>
                        <input type="number" name="rental_days" value="7" min="1" max="30" id="rentalDays" onchange="calculateTotal()">
                    </div>
                    <div class="form-group">
                        <label>T·ªïng ti·ªÅn</label>
                        <input type="text" id="totalCost" readonly value="{{ book.rental_price_per_day }}k √ó 7 ng√†y = {{ book.rental_price_per_day|floatformat:0 }}k">
                    </div>
                    <button type="submit" class="btn btn-primary">üõí Th√™m V√†o Gi·ªè H√†ng</button>
                </form>
                {% else %}
                <button class="btn btn-primary" disabled>H·∫øt H√†ng</button>
                {% endif %}

                <div class="book-description">
                    <h2>M√¥ t·∫£</h2>
                    <p>{{ book.description }}</p>
                </div>
            </div>
        </div>

        {% if similar_books %}
        <div class="similar-books">
            <h2 class="section-title">S√°ch T∆∞∆°ng T·ª±</h2>
            <div class="books-grid">
                {% for similar in similar_books %}
                <div class="book-card" onclick="window.location.href='{% url 'book_detail' similar.id %}'">
                    <div class="book-cover">
                        {% if similar.cover_image %}
                        <img src="{{ similar.cover_image }}" alt="{{ similar.title }}">
                        {% endif %}
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">{{ similar.title }}</h3>
                        <p class="book-author">{{ similar.author }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        const pricePerDay = {{ book.rental_price_per_day }};
        function calculateTotal() {
            const days = document.getElementById('rentalDays').value || 7;
            const total = (pricePerDay * days).toFixed(0);
            document.getElementById('totalCost').value = `${pricePerDay}k √ó ${days} ng√†y = ${total}k`;
        }
    </script>
</body>
</html>